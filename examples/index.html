<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>uploader</title>
</head>

<body>
    <div>
        <label>
            <input type="file" name="" id="file" multiple>
        </label>
    </div>

    <script src="/md5.min.js"></script>
    <script src="/dist/uploader.js"></script>
    <script>
        var $file = document.getElementById('file');
        var uploader = new Uploader('/upload', {
            onSuccess(files) {
                console.log(files)
            },
            onError(ev) {
                console.log(ev)
            },
            onProgress(p) {
                console.log(p)
            },
            headers: {

            }
        });
        $file.onchange = function (ev) {
            if (!this.files.item(0)) return;

            var createReader = function (file) {
                return new Promise(function (resolve, reject) {
                    var reader = new FileReader();
                    reader.onload = function (ev) {
                        return resolve({
                            uploadId: md5(ev.target.result),
                            input: file,
                        });
                    }

                    reader.onerror = reject;

                    reader.readAsArrayBuffer(file)
                });
            }

            var promises = Array.from(this.files).map(createReader);
            Promise.all(promises).then(function (files) {
                uploader.submit(files);
            })
        }
    </script>
</body>

</html>